--- 
title: "Arbuscular mycorrhizal fungi colonization" 
author: "Marco Chiapello"
output:  
  BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{Ramf colonization analysis} 
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r env, echo=FALSE, warnings=FALSE}
library("Ramf")
library("BiocStyle")
```
### Introduction

The package is meant to help scientists to compute the degree of arbuscular
mycorrhizal fungi.

All the functions of the package work independently of the colonization scoring system.

#### Grid scoring system

...

#### Trouvelot scoring system

...

### Loading the data 

To load data in, use the follow command: 

>readData

#### Example
```{r loadData}
# Grid
f <- dir(system.file("extdata", package = "Ramf"), full.names = TRUE, pattern = "grid.csv")
gr <- readData(f)
# Trouvelot
f <- dir(system.file("extdata", package = "Ramf"), full.names = TRUE, pattern = "trouvelot.csv")
tr <- readData(f) 
tr
```

It is very important the order of the samples in the csv file. The first sample will
be considered the control.


### Summarize data

To summarise the data and export the scoring results in a tabular format use the
follow command:

> am_summary


#### Example
```{r summary}
grs <- am_summary(gr)
trs <- am_summary(tr)
grs
trs
```

### Statistical analysis

The statistical analysis is performed using the `conover.test` package. To read more
about the statatical framework, refer to this [link](https://cran.r-project.org/web/packages/conover.test/).

> am_stat


#### Example
```{r stat}
grst <- am_stat(gr)
trst <- am_stat(tr)
grst
trst
```

By default, the correction method is "none", but it is possible to select between:
 Bonferroni, Šidák, Holm,
 Holm-Šidák, Hochberg, Benjamini-Hochberg, or Benjamini-Yekutieli adjustment. 
 For more details refer to [conover.test package](https://cran.r-project.org/web/packages/conover.test/conover.test.pdf).

#### Example
```{r stat2}
am_stat(gr, method = "bh")
am_stat(tr, method = "sidak")
```

conover.test outputs both t-test-statistics for each pairwise comparison and the p-value = P(T ≥
|t|) for each, so one would reject Ho if p ≤ α/2. IMPORTANT NOTE: the p-values just described
are sometimes called "one-sided,", Ramf package transform them into "two-sided" p-values.

(notice that p ≤ α/2 and 2p ≤ α are equivalent rejection decisions).

### Plot data

To summarise the data in a graphical way the package provide 3 plot types:

- barplot

  >am_barplot

- boxplot

  >am_boxplot

- dotplot

  >am_dotplot

It is possible to plot a simple plot.

#### Example
```{r plot}
am_barplot(gr)
am_boxplot(gr)
am_dotplot(gr)
am_barplot(tr)
am_boxplot(tr)
am_dotplot(tr)
```

The plot fuctions take a set of option to customize your plot.

#### Example
```{r plot2}
am_barplot(gr, cbPalette = c('#f7f7f7', '#d9d9d9', '#bdbdbd', '#969696'))
am_barplot(gr, cbPalette = c('#f7f7f7', '#d9d9d9', '#bdbdbd', '#969696'), main = "Grid")
# Plot with statistical information
am_barplot(gr, cbPalette = c('#ca0020', '#f4a582', '#92c5de', '#0571b0'), main = "Grid",
		   stats = "asterisks")
# Statistical test corrected
am_barplot(gr, cbPalette = c('#ca0020', '#f4a582', '#92c5de', '#0571b0'), main = "Grid",
		   stats = "asterisks", method = "bh")
```

The asterisks below the plot show which sample is significant different from the control. 
The control is always the first element of the list.


### Save data

To export the summary data, a "save data" function is provided. The function 
exports both the summary per replicate and the summary per sample in two distinct
csv files.

#### Example
```{r save}
# Save the summary
am_save(grs) # Two files will be saved: Summary_per_Replicate.csv and Summary_per_Sample.csv
am_save(trs, "Trouvelot") # Two files will be saved: Trouvelot_per_Replicate.csv and Trouvelot_per_Sample.csv

# Save the statisticas
am_save(am_stat(gr)) # One file called Summary_Stat.csv will be saved
am_save(am_stat(tr, method = "bh"), "Trouvelot") # One file called Trouvelot_stat.csv will be saved

# Save the plots
am_save(am_barplot(gr), "barplor_grid.pdf")
p1 <- am_barplot(gr, cbPalette = c('#f7f7f7', '#d9d9d9', '#bdbdbd', '#969696'), main = "Trouvelot",
		   stats = "asterisks", method = "bh")
am_save(p1, "dotplor_trouvelot.pdf", width = 21, height = 21, units = "cm", dpi = 300)

# Save jpg plot
am_save(p1, "dotplor_trouvelot.jpg")
```


